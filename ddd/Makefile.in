# $Id$
# DDD Makefile.

# Copyright (C) 1995-1997 Technische Universitaet Braunschweig, Germany.
# Written by Andreas Zeller <zeller@ips.cs.tu-bs.de>.
# 
# This file is part of the DDD Library.
# 
# The DDD Library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Library General Public
# License as published by the Free Software Foundation; either
# version 2 of the License, or (at your option) any later version.
# 
# The DDD Library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
# See the GNU Library General Public License for more details.
# 
# You should have received a copy of the GNU Library General Public
# License along with the DDD Library -- see the file COPYING.LIB.
# If not, write to the Free Software Foundation, Inc.,
# 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
# 
# DDD is the data display debugger.
# For details, see the DDD World-Wide-Web page, 
# `http://www.cs.tu-bs.de/softech/ddd/',
# or send a mail to the DDD developers <ddd@ips.cs.tu-bs.de>.


### CUSTOMIZATION SECTION --- Please check the settings below.
# Typical values are enclosed in ().

## Directories.

# Common prefix for installation directories.  (/usr/local)
# NOTE: This directory must exist when you start the install.
prefix = @prefix@
exec_prefix = @exec_prefix@

# Where to fetch the source from.  (.)
srcdir = @srcdir@
VPATH = @srcdir@

# Where to put the binary.  (${exec_prefix}/bin)
bindir = @bindir@

# Where to put the info file.  (${prefix}/info)
infodir = @infodir@

# Where to put the manual page.  (${prefix}/man)
mandir  = @mandir@
man1dir = $(mandir)/man1
man1ext = .1


## Architecture (usually overridden by the top-level Makefile).

# The host we were compiled on.  (CPU-COMPANY-SYSTEM)
host_canonical = @host@

# The target we were compiled for.  (CPU-COMPANY-SYSTEM)
target_canonical = @host@


## Special commands.

# The sed command.  (sed)
SED = @SED@

# The rm command.
RM = rm -f

# The ln -s command for making symbolic links; plain ln should work
# too.  (ln -s)
LN_S = @LN_S@

# The m4 command, preferably GNU m4.   (m4)
M4 = @M4@

# The lex command (flex), its flags (-8), and its library (-lfl).
LEX = @LEX@
LFLAGS = @LFLAGS@
LEXLIB = @LEXLIB@

# The yacc command (bison -y) and its flags ().
YACC = @YACC@
YFLAGS = @YFLAGS@

# The shell for executing commands in the Makefile.  (/bin/sh)
SHELL = @SH@

# The ar command.
AR = ar

# ar flags for creating a new archive.
AR_FLAGS = q

# ar flags for extracting files from an archive.
AR_X_FLAGS = x

# The ranlib command.  (ranlib)
RANLIB = @RANLIB@

# A compress command, reading from stdin and writing to stdout.  (gzip -c)
COMPRESS = @COMPRESS@

# An uncompress command, reading from stdin and writing to stdout.  (gunzip -c)
UNCOMPRESS = @UNCOMPRESS@


## The C++ compiler.

# What we use to compile C++ files.  (c++)
CXX = @CXX@

# The flags we use to compile C++ files.
# CXXOPT = -DNDEBUG -O2
CXXOPT = @CXXOPT@
# CXXDEBUG = -g
CXXDEBUG = @CXXDEBUG@
# CXXWARNINGS = -Wall
CXXWARNINGS = @CXXWARNINGS@
CXXFLAGS = $(CXXOPT) $(CXXDEBUG) $(CXXWARNINGS)

# Extra C++-specific flags.  (-fexternal-templates -felide-constructors)
CXXSTUFF = @CXXSTUFF@

# Possible extra libraries required for all C++ programs.  ()
CXXLIBS = @CXXLIBS@


## The C compiler; for demos only

# What we use to compile C files.
# CC = cc
CC = @CC@

# The flags we use to compile C files.
# CFLAGS = -g
CFLAGS = @CFLAGS@


## The Pascal compiler (for demos only)

# What we use to compile Pascal files.
PC = pc

# The flags we use to compile Pascal files.
PFLAGS = -g


## The Modula-2 compiler (for demos only)

# What we use to compile Modula-2 files.
M2C = m2c

# The flags we use to compile Modula-2 files.
M2FLAGS = -g


## The C preprocessor.

# What we use for preprocessing.  (gcc -E -traditional-cpp)
CPP = @CPP_TRADITIONAL@

# Flags passed to the C preprocessor.  ()
CPPFLAGS = @CPPFLAGS@

# Definitions to be passed to the C preprocessor.  (-DHAVE_CONFIG_H)
DEFS = @DEFS@


## The Linker.

# Flags passed to the linker.  (-g -O)
LDFLAGS = @LDFLAGS@

# Use this for building statically linked executables with GCC.
# LDFLAGS = -static @LDFLAGS@



## Local libraries

# POSIX regex routines (from system or ../librx/librx.a)
# LIBRX      = @LIBRX@
LIBRX      =
# termcap routines (from system or ../termcap/libtermcap.a)
LIBTERMCAP = @LIBTERMCAP@
# -liberty library (../libiberty/libiberty.a)
LIBIBERTY  = @LIBIBERTY@
# Yacc library (-ly)
LIBY       = @LIBY@
# Math library (-lm)
LIBM       = @LIBM@
# C library (-lc)
LIBC       = @LIBC@
# NSL library (-lnsl)
LIBNSL     = @LIBNSL@
# Additional libraries required for non-X programs (-lsocket -lnsl)
NON_X_LIBS = @LIBS@

# All libraries shown above
LIBS = $(CXXLIBS) $(LIBNSL) $(LIBRX) $(LIBTERMCAP) $(LIBY) $(LIBIBERTY) $(LIBM)


## X Libraries

# Special flags for linking with X.  (-L/usr/X11R5/lib)
X_LDFLAGS = @X_LIBS@

# Motif library.  (-lXm)
LIBXM = @XM_LIBS@

# Use this for building `semistatic' executables where Motif libraries
# are statically linked in.
# LIBXM = -Wl,-Bstatic @XM_LIBS@ -Wl,-Bdynamic

# Athena libraries.  (-lXaw -lXmu)
LIBXAW = @XAW_LIBS@

# X extension library; needed for Athena and Motif 2.0.  (-lXext)
LIBXEXT = @XEXT_LIBS@

# Xpm library; sometimes needed for Motif 2.0.  (-lXpm)
LIBXPM = @XPM_LIBS@

# gen library; sometimes needed for Motif 2.0.  (-lgen)
LIBGEN = @LIBGEN@

# X toolkit library.  (-lXt)
LIBXT = @XT_LIBS@

# X library.  (-lSM -lICE -lX11 -lnsl -lsocket)
LIBX11 = @X_PRE_LIBS@ @X11_LIBS@ @X_EXTRA_LIBS@

# All libraries shown above
ALL_X_LIBS = $(X_LDFLAGS) $(LIBXM) $(LIBXPM) $(LIBXAW) $(LIBXEXT) \
$(LIBXT) $(LIBX) $(LIBX11) $(LIBGEN)


## Installation commands.

# General install program.  (install -c)
INSTALL = @INSTALL@

# Command for installing programs.  (install -c)
INSTALL_PROGRAM = @INSTALL_PROGRAM@

# Command for installing data.  (install -c -m 644)
INSTALL_DATA = @INSTALL_DATA@

# Transformed name of installed programs.  (s,x,x,)
transform=@program_transform_name@


## The following definitions are needed for development only.
## Usually, you don't need any of these.

# The autoconf program.
AUTOCONF = autoconf

# The autoheader program.
AUTOHEADER = autoheader

# The tar program.  (gtar)
TAR = @TAR@

# The groff program.
GROFF = groff

# The nroff program.
# NROFF = nroff
NROFF = $(GROFF) -Tascii

# The makeinfo program.
MAKEINFO = makeinfo

# The texindex program.
TEXINDEX = texindex

# The texi2html program.
TEXI2HTML = texi2html

# The TeX program.
TEX = tex

# The ad2c program.
AD2C = $(SED) -n -f $(srcdir)/ad2c.sed

# The vsl2c program.
VSL2C = $(SED) -f $(srcdir)/vsl2c.sed

# The dvips program.  (dvips)
DVIPS = @DVIPS@

# The co and ci programs.
CO = co
CI = ci

# The rcsdiff program.
RCSDIFF = rcsdiff

# The ls program.
LS = ls

# The head program.
HEAD = head

# The make program, if not predefined.  ()
@SET_MAKE@

# The mv command.
MV = mv

# The echo command.
ECHO = echo

# The awk command.  (awk)
AWK = @AWK@

# The cat command.
CAT = cat

# The cut command.
CUT = cut

# The cmp command.
CMP = cmp

# The grep command.
GREP = grep

# The sort command.
SORT = sort

# The diff command.
DIFF = @DIFF@

# The touch command.
TOUCH = touch

# The date command.
DATE = date

# The strip command.
STRIP = strip

# The mkdir and rmdir commands.
MKDIR = mkdir
RMDIR = rmdir

# The GNU Debugger.
GDB = gdb

# The fig2dev command.
FIG2DEV = fig2dev
FIG2PS = $(FIG2DEV) -L ps

# Some XPM/PPM/PostScript converters, from the netpbm and pbmplus packages.
XPMTOPPM   = xpmtoppm
PNMTOPS    = pnmtops
PPMTOPGM   = ppmtopgm
PGMTOPBM   = pgmtopbm
PBMTOXBM   = pbmtoxbm
PNMGAMMA   = pnmgamma
PGMENHANCE = pgmenhance
PNMDEPTH   = pnmdepth
SXPM       = sxpm

### END OF CUSTOMIZATION SECTION ---
### You shouldn't need to change anything below this line.


## The names.
# Program and distribution base name.  (ddd)
ddd = @ddd@

# Product name.  (DDD)
DDD = @DDD@

# The version number.  (1.4c)
VERSION = @VERSION@

# Canonical program and distribution base name.
ddd_canonical = $(ddd)-$(VERSION)-$(target_canonical)

# Index file fix.
FIX_INDEX = $(SED) -f $(srcdir)/fixindex.sed

# Newhelp command.
NEWHELP = sed="$(SED)" $(SHELL) $(srcdir)/newhelp

# Makeman command.
MAKEMAN = srcdir="$(srcdir)" cpp="$(CPP)" $(SHELL) $(srcdir)/makeman \
-D__MAN_VERSION__="\"$(DDD) $(VERSION)\"" -D__MAN_TITLE__="\"$(DDD) Tools\""

# Get-node command.
GET_NODE = $(SHELL) $(srcdir)/get-node

## More compilation settings.
# C++ binding flags. For binary distribution only.
# CXXSTATIC_BINDING = -Bstatic
CXXSTATIC_BINDING = @CXXSTATIC_BINDING@
# CXXDYNAMIC_BINDING = -Bdynamic
CXXDYNAMIC_BINDING = @CXXDYNAMIC_BINDING@
CXXBINDING = 

## C++ compile commands.
COMPILE.cc = $(CXX) $(CPPFLAGS) $(DEFS) $(CXXFLAGS) $(CXXSTUFF) -c
LINK.cc = $(CXX) $(CXXBINDING) $(LDFLAGS)
COMPILE_AND_LINK.cc = \
    $(CXX) $(CPPFLAGS) $(DEFS) $(CXXFLAGS) $(CXXSTUFF) $(CXXBINDING) $(LDFLAGS)

## C compile commands.
COMPILE.c = $(CC) $(CPPFLAGS) $(DEFS) $(CFLAGS) -c
LINK.c = $(CC) $(LDFLAGS)
COMPILE_AND_LINK.c = \
    $(CC) $(CPPFLAGS) $(DEFS) $(CFLAGS) $(LDFLAGS)

## Pascal compile commands.
COMPILE_AND_LINK.p = $(PC) $(CPPFLAGS) $(DEFS) $(PFLAGS)
COMPILE.p = $(COMPILE_AND_LINK.p) -c
LINK.p = $(PC)

## Modula-2 compile commands.
COMPILE_AND_LINK.m2 = $(M2C) $(M2FLAGS)
COMPILE.m2 = $(COMPILE_AND_LINK.m2) -c
LINK.m2 = $(M2C)

## YACC commands.
YY = yy
YACCTOCPLUS = $(SHELL) $(srcdir)/yacctoC -prefix $(YY) \
	&& $(RM) y.tab.c y.tab.h
YACC.Y = $(YACC) $(YFLAGS)

## LEX commands.
LEXTOCPLUS = $(SHELL) $(srcdir)/lextoC -prefix $(YY) && $(RM) lex.yy.c
LEX.L = $(LEX) $(LFLAGS)

## Where to look for X include files.  (-I/usr/X11R5/include)
X_INCLUDE = @X_CFLAGS@

## Where to look for include files.
INCLUDE = -I. -I$(srcdir) -I$(srcdir)/.. -I$(srcdir)/../include -I$(icondir) $(X_INCLUDE)

## Implicit rules.
.SUFFIXES: .C .cc .c .mod .p .Y .YY .L .txt
.C.o:
	$(COMPILE.cc) $(INCLUDE) -o $@ $<
.cc.o:
	$(COMPILE.cc) $(INCLUDE) -o $@ $<
.c.o:
	$(COMPILE.c) $(INCLUDE) -o $@ $<
.p.o:
	$(COMPILE.p) -o $@ $<
.Y:
	$(YACC.Y) $<
	$(YACCTOCPLUS)
	$(LINK.cc) -o $@ y.tab.C $(LDLIBS)
	$(RM) y.tab.C y.tab.H
.Y.C:
	$(YACC) $(YFLAGS) $<
	$(YACCTOCPLUS)
	$(MV) y.tab.C $@
	$(RM) y.tab.H
.Y.h:
	$(YACC) -d $(YFLAGS) $<
	$(YACCTOCPLUS)
	$(MV) y.tab.H $@
	$(RM) y.tab.C
.Y.o:
	$(YACC) $(YFLAGS) $<
	$(YACCTOCPLUS)
	$(COMPILE.cc) y.tab.C
	$(RM) y.tab.C y.tab.H
.Y.YY:
	$(YACC) -v $(YFLAGS) $<
	$(MV) y.output $@
	$(RM) y.tab.c
.L:
	$(LEX.L) $<
	$(LEXTOCPLUS)
	$(LINK.cc) -o $@ lex.yy.C $(LDLIBS)
	$(RM) lex.yy.C
.L.C:
	$(LEX.L) $<
	$(LEXTOCPLUS)
	$(MV) lex.yy.C $@
.L.o:
	$(LEX.L) $<
	$(LEXTOCPLUS)
	$(COMPILE.cc) -o $@ lex.yy.C
	$(RM) lex.yy.C

## Script rules
.txt.C:
	( \
	$(ECHO) '// $@ -- generated automatically from `$<'"'."; \
	$(SED) '/^ *#/d' $< | \
	$(SED) 's/^ *include \([^"][^.]*\)\..*$$/#include "\1.C"/' | \
	$(SED) 's/^ *include "\([^"][^.]*\)[^"]*"/#include "\1.C"/' | \
	$(SED) '/^[^#]/s/\(["'"'"'\\]\)/\\\1/g' | \
	$(SED) '/^[^#]/s/.*/"&\\n"/' | \
	$(SED) 's//\\b/g' | \
	$(SED) 's/^$$/"\\n"/' \
	) > tmp.C; \
	$(CPP) -C -P -undef $(CPPFLAGS) $(DEFS) $(INCLUDE) tmp.C > $@; \
	$(RM) tmp.C



## Libraries and object files
# General-purpose utilities: strings, regexps, run-type type info...
BASE_OBJECTS = \
	compare.o    \
	cook.o       \
	glob.o       \
	hash.o       \
	rxclass.o    \
	sigName.o    \
	strclass.o   \
	tabs.o       \
	SignalB.o    \
	TypeInfo.o   \
	UniqueId.o   \
	MemCheck.o   \
	Range.o

# Instantiated templates
TEMPLATE_OBJECTS = \
	IntIntAA.o   \
	StringA.o    \
	StringMap.o  \
	StringSA.o   \
	VoidArray.o  \
	WidgetSA.o

# Interprocess communication
# Top-level class is `Agent', declared in `Agent.h'
AGENT_OBJECTS = \
	Agent.o      \
	AgentM.o     \
	AsyncAgent.o \
	ChunkQueue.o \
	DataLength.o \
	HandlerL.o   \
	LiterateA.o  \
	TimeOut.o    \
	TTYAgent.o

# Miscellaneous utilities for X programs: Motif strings, hourglasses,
# context-sensitive help...
XSTUFF_OBJECTS = \
	charsets.o   \
	converters.o \
	events.o     \
	findParent.o \
	fileSBF.o    \
	longName.o   \
	verify.o     \
	Delay.o      \
	DestroyCB.o  \
	ExitCB.o     \
	LessTifH.o   \
	MString.o    \
	MakeMenu.o

# Box library - rectangular composible graphical items
# Top-level class is `Box', declared in `Box.h'
BOX_OBJECTS = \
	printBox.o   \
	AlignBox.o   \
	ArcBox.o     \
	BinBox.o     \
	Box.o        \
	BoxD.o       \
	BoxExtend.o  \
	BoxPoint.o   \
	BoxRegion.o  \
	BoxSize.o    \
	ColorBox.o   \
	CompositeB.o \
	DiagBox.o    \
	DummyBox.o   \
	FixBox.o     \
	FontFixBox.o \
	FontTable.o  \
	HatBox.o     \
	LineBox.o    \
	ListBox.o    \
	MarkBox.o    \
	MatchBox.o   \
	PrimitiveB.o \
	SlopeBox.o   \
	StringBox.o  \
	THatBox.o    \
	TagBox.o     \
	TrueBox.o

# VSL library - building boxes from structured data
# Top-level class is `VSLLib', declared in `VSLLib.h'
VSL_OBJECTS = \
	ArgNode.o    \
	BuiltinCN.o  \
	CallNode.o   \
	ConstNode.o  \
	DefCallN.o   \
	DummyNode.o  \
	LetNode.o    \
	NameNode.o   \
	ListNode.o   \
	TestNode.o   \
	TrueNode.o   \
	VSEFlags.o   \
	VSLBuiltin.o \
	VSLDef.o     \
	VSLDefList.o \
        VSLErr.o     \
	VSLLib.o     \
	VSLNode.o    \
        VSLRead.o

# Graph structure, graph layout and graph editor widget
# Top-level classes are `Graph', declared in `Graph.h'
# and the `GraphEdit' widget, deckared in `GraphEdit.h'.
GRAPH_OBJECTS = \
	layout.o     \
	BoxGraphN.o  \
	Graph.o      \
	GraphEdge.o  \
	GraphEdit.o  \
	GraphGC.o    \
	GraphNode.o  \
	HintGraphN.o \
	LineGraphE.o \
	ArcGraphE.o  \
	PannedGE.o   \
	PosGraphN.o  \
	RegionGN.o   \
	ScrolledGE.o

# All these objects were originally part of the NORA library; they are
# now maintained as part of DDD.
LIB_OBJECTS = \
	$(BASE_OBJECTS)   \
	$(TEMPLATE_OBJECTS)  \
	$(AGENT_OBJECTS)  \
	$(XSTUFF_OBJECTS) \
	$(BOX_OBJECTS)    \
	$(VSL_OBJECTS)    \
	$(GRAPH_OBJECTS)

# The DDD application itself.  `ddd.C' is the main program, `SourceView.C'
# is the source window, `DataDisp.C' is the data window.
DDD_OBJECTS = \
	args.o       \
	buttons.o    \
	cmdtty.o     \
	configinfo.o \
	comm-manag.o \
	complete.o   \
	ctrl.o       \
	dbx-lookup.o \
	disp-read.o  \
	editing.o    \
	environ.o    \
	exectty.o    \
	exit.o       \
	expired.o    \
	file.o       \
	filetype.o   \
	gdbinit.o    \
	graph.o      \
	history.o    \
	hostname.o   \
	index.o      \
	logo.o       \
	mydialogs.o  \
	options.o    \
	post.o       \
	print.o      \
	question.o   \
	regexps.o    \
	resources.o  \
	sashes.o     \
	select.o     \
	session.o    \
	settings.o   \
	shell.o      \
	shorten.o    \
	show.o       \
	source.o     \
	status.o     \
	string-fun.o \
	ungrab.o     \
	value-read.o \
	windows.o    \
	wm.o         \
	xconfig.o    \
	AliasGE.o    \
	ArgField.o   \
	BreakPoint.o \
	BreakPM.o    \
	CodeCache.o  \
	Command.o    \
	DataDisp.o   \
	DispBox.o    \
	DispBuffer.o \
	DispGraph.o  \
	DispNode.o   \
	DispNodeM.o  \
	DispValue.o  \
	EntryType.o  \
	GDBAgent.o   \
	HelpCB.o     \
	PosBuffer.o  \
	SourceView.o \
	WhatNextCB.o

# Objects required for userinfo
USERINFO_OBJECTS =

# Objects required for huffencode and huffdecode
HUFFMAN_OBJECTS = strclass.o cook.o rxclass.o

## All objects.
OBJECTS = $(LIB_OBJECTS) $(DDD_OBJECTS)

## The program files.
PROGS = $(ddd)

## Extra demonstration files.
DEMOS = userinfo stringify huffencode huffdecode cxxtest ctest test-file \
	test-graph vsl ttytest bug ptest m2test tString mmtest

## Where to find texinfo files and so
MAKEINFO_FLAGS = \
	-I. -I$(srcdir) -I$(srcdir)/../readline/doc -I$(srcdir)/../texinfo

## The index files
IDXS = *.cp *.fn *.ky *.pg *.tp *.vr

## The dvi files.
DVIS =

## The postscript files.
PSS = $(srcdir)/../doc/ddd.man-nopics.ps $(srcdir)/../doc/ddd.man.ps

## PostScript pictures in the DDD manual.
# All of these are generated from FIG and XPM files.
picdir = $(srcdir)/PICS
PICS = \
	$(picdir)/dddlogo.ps            \
	$(picdir)/ddd-aliases.ps        \
	$(picdir)/ddd-all.ps            \
	$(picdir)/ddd-arguments.ps      \
	$(picdir)/ddd-attach.ps         \
	$(picdir)/ddd-backtrace.ps	\
	$(picdir)/ddd-bp-popup.ps       \
	$(picdir)/ddd-button-editor.ps  \
	$(picdir)/ddd-code.ps           \
	$(picdir)/ddd-cond.ps           \
	$(picdir)/ddd-console.ps        \
	$(picdir)/ddd-data-prefs.ps     \
	$(picdir)/ddd-drag.ps           \
	$(picdir)/ddd-edit-displays.ps  \
	$(picdir)/ddd-general-prefs.ps  \
	$(picdir)/ddd-hide-display.ps   \
	$(picdir)/ddd-history.ps        \
	$(picdir)/ddd-layout.ps         \
	$(picdir)/ddd-line-popup.ps     \
	$(picdir)/ddd-locals.ps	        \
	$(picdir)/ddd-new-display.ps    \
	$(picdir)/ddd-open.ps           \
	$(picdir)/ddd-open-session.ps   \
	$(picdir)/ddd-print-graph.ps    \
	$(picdir)/ddd-print-output.ps   \
	$(picdir)/ddd-print-popup.ps    \
	$(picdir)/ddd-registers.ps      \
	$(picdir)/ddd-rotate-display.ps \
	$(picdir)/ddd-save-session.ps   \
	$(picdir)/ddd-select-display.ps \
	$(picdir)/ddd-set.ps	        \
	$(picdir)/ddd-settings.ps       \
	$(picdir)/ddd-shortcuts.ps      \
	$(picdir)/ddd-shortcut-editor.ps \
	$(picdir)/ddd-source-popup.ps   \
	$(picdir)/ddd-source-prefs.ps   \
	$(picdir)/ddd-source.ps         \
	$(picdir)/ddd-startup-prefs.ps  \
	$(picdir)/ddd-status-displays.ps \
	$(picdir)/ddd-threads.ps        \
	$(picdir)/ddd-tool.ps           \
	$(picdir)/ddd-value-tip.ps

## The HTML files.
# HTML_BASES = ddd_toc.html dddint_toc.html
# HTML_PATTERNS = $(srcdir)/ddd_*.html $(srcdir)/dddint_*.html
# HTMLS = $(HTML_BASES) $(HTML_PATTERNS)
HTMLS = 

## The manual page.
MANS = $(srcdir)/ddd.man

## The (derived) icons
icondir = $(srcdir)/../icons
ICONS = $(icondir)/ddd.xbm $(icondir)/dddmask.xbm $(icondir)/dddlogo.xbm

## Readme files built from ddd.texinfo
README_FILES = 

## GDB symbol files
SYMS = $(ddd).syms $(ddd_canonical).syms


## Intermediate files

# Files required for building DDD.
# In a distribution, these should be already built.
PROG_STUFF       = config.h vsl-lex.C vsl-gramma.h vsl-gramma.C rxscan.C \
	 	   acconfig.h acspecial.h stamp-h.in \
		   ddd.vsl.h vr.h version.h configinfo.C \
		   ddd.man ddd.man.txt ddd.man.txt.gz COPYING.gz \
		   ddd.man.txt.gz.C COPYING.gz.C xlibdir.C eps-code.h

# Extra files to be built for the distribution
# In a distribution, these should be already built.
DIST_STUFF	 = $(PROG_STUFF) $(MANS) $(PSS) $(ICONS)

# Temporary Files to be cleaned, keeping configuration intact
CLEAN_STUFF	 = $(ddd)-$(VERSION)-* $(PROGS) $(DEMOS) $(PICS) \
		   core *.o *.a *.s *.i \
		   tmp* *.tmp .*hist* *.syms *.log dddgraph.* \
		   *.aux *.cp *.cps *.fn *.fns *.flc \
		   *.ky *.kys *.log *.pg *.pgs *.toc *.tp *.tps *.vr *.vrs \
		   *.tar *.tar.gz *~ lex.* y.tab.* site.* *.sum \
		   *.diff rcssync *.private USERINFO *.huff.C \
		   *.txt.gz COPYING.gz *.gz.C

# Architecture-dependent files to be deleted from distribution
DISTCLEAN_STUFF	 = $(CLEAN_STUFF) \
		   config.status config.h host.h paths.h \
		   Makefile MakeOut LOG OOBR OOBR-FTR \
		   config.log config.cache configinfo.C stamp-h \
		   Ddd Ddd.ad.h ddd.1 ddd.man-nopics

# Any files that can be reconstructed, except configure script
REALCLEAN_STUFF	 = $(DISTCLEAN_STUFF) $(DIST_STUFF) \
		   header.str trailer.str eps-code.h vr.h

# All files that can be reconstructed (but may require special programs)
ULTRACLEAN_STUFF = $(REALCLEAN_STUFF) \
		   config.h.in stamp-h.in configure Makedeps \
		   $(MANS) $(README_FILES) $(HTMLS) $(srcdir)/Ddd.in


## Targets as specified in GNU standards.
all:	ddd-message $(PROG_STUFF) $(PROGS) ddd-done
	@:
.PHONY: all

.PHONY: ddd-message
ddd-message:
	@$(ECHO) "Building $(ddd_canonical)..."

.PHONY: ddd-done
ddd-done: $(ddd)
	@$(ECHO) "Building $(ddd_canonical)... done."
	@$(ECHO) "You may now type \`make check' for a test or \`make debug' for debugging DDD."

.PHONY: install
install: install-prog install-man
	@:

.PHONY: install-strip
install-strip:
	$(MAKE) INSTALL_PROGRAM='$(INSTALL_PROGRAM) -s' install

.PHONY: uninstall
uninstall: uninstall-prog uninstall-man
	@:

# install-prog does not depend on $(PROGS) 
# since we may have precompiled packages
.PHONY: install-prog
install-prog:
	for p in $(PROGS); do \
	    $(INSTALL_PROGRAM) \
		$$p $(bindir)/`$(ECHO) $$p | $(SED) '$(transform)'`; \
	done

.PHONY: uninstall-prog
uninstall-prog:
	for p in $(PROGS); do \
	    $(RM) $(bindir)/`$(ECHO) $$p | $(SED) '$(transform)'`; \
	done

.PHONY: install-info
install-info: $(INFO_BASES)
	-parent=`$(ECHO) $(infodir) | $(SED) -e 's@/[^/]*$$@@'`; \
	test -d $$parent || $(MKDIR) $$parent
	-test -d $(infodir) || $(MKDIR) $(infodir)
	for i in $(INFOS); do \
	    test -f $$i && $(INSTALL_DATA) $$i $(infodir); \
	done

.PHONY: uninstall-info
uninstall-info:
	cd $(infodir); $(RM) $(INFOS)

.PHONY: install-man
install-man: ddd.man
	-parent=`$(ECHO) $(man1dir) | $(SED) -e 's@/[^/]*$$@@'`; \
	test -d $$parent || $(MKDIR) $$parent
	-test -d $(man1dir) || $(MKDIR) $(man1dir)
	$(INSTALL_DATA) ddd.man \
		$(man1dir)/`$(ECHO) ddd$(man1ext) | $(SED) '$(transform)'`

.PHONY: uninstall-man
uninstall-man:
	$(RM) $(man1dir)/`$(ECHO) ddd$(man1ext) | $(SED) '$(transform)'`

.PHONY: picsclean
picsclean:
	$(RM) $(PICS) ./#*#
	-test -d $(picdir) && cd $(picdir) && $(RM) $(CLEAN_STUFF) ./#*#

.PHONY: clean
clean:
	$(RM) $(CLEAN_STUFF) ./#*#
	-test -d $(picdir) && cd $(picdir) && $(RM) $(CLEAN_STUFF) ./#*#

.PHONY: distclean
distclean:
	$(RM) $(DISTCLEAN_STUFF) ./#*#

.PHONY: mostlyclean
mostlyclean: clean
	@:

.PHONY: realclean maintainer-clean
realclean maintainer-clean:
	@echo 'This command is intended for maintainers to use; it'
	@echo 'deletes files that may need special tools to rebuild.'
	$(RM) $(REALCLEAN_STUFF) ./#*#

.PHONY: ultraclean
ultraclean:
	@echo 'This command is intended for maintainers to use; it'
	@echo 'deletes files that may need special tools to rebuild.'
	$(RM) $(ULTRACLEAN_STUFF) ./#*#

.PHONY: info
info:	$(INFO_BASES)
	@:

.PHONY: dvi
dvi:	$(DVIS)
	@:

.PHONY: ps
ps:	$(PSS)
	@:

.PHONY: man
man:	$(MANS)
	@:

.PHONY: postscript
postscript: $(PSS)
	@:

.PHONY: html
html:	$(HTML_BASES)
	@:

.PHONY: lib
lib:	$(LIB)
	@:

.PHONY: readme
readme:	$(README_FILES)
	@:

.PHONY: diststuff
diststuff: $(DIST_STUFF)
	-for file in $(DIST_STUFF); do test -f $$file && $(TOUCH) $$file; done

.PHONY: dist
dist:	
	@$(ECHO) see the top-level directory for making dist files.
	@false

.PHONY: strip
strip:	$(PROGS)
	-$(STRIP) $(PROGS)

.PHONY: progs programs
progs:	$(PROGS)
	@:
programs: $(PROGS)
	@:

.PHONY: demos
demos:	$(DEMOS)
	@:


## A TECO-ism

.PHONY: love
love:
	@$(ECHO) 'not war?'


## FORCE target

.PHONY: FORCE
FORCE:
	@:


## The resource header and app-default files.

Ddd.ad.h: Ddd $(srcdir)/ad2c.sed
	$(AD2C) Ddd > Ddd.ad.h

$(srcdir)/Ddd.in: $(srcdir)/Ddd.in.m4 $(srcdir)/macros.m4
	( \
		echo "define(srcdir, \`$(srcdir)')dnl"; \
		echo "include(srcdir()/Ddd.in.m4)dnl" \
	) | $(M4) > $@


## The VSL header files.

VSL_CPP = $(CPP) -I$(srcdir)/../vsllib -I$(prefix)/lib/vsl-include
ddd.vsl.h: ddd.vsl $(srcdir)/vsl2c.sed
	$(CAT) $(srcdir)/ddd.vsl > tmp.c
	$(VSL_CPP) tmp.c | $(VSL2C) > ddd.vsl.h
	$(RM) tmp.c

# `make depend' fails to find this dependency :-(
DispBox.o: ddd.vsl.h

# And these are never computed:
ddd.vsl.h: $(srcdir)/../vsllib/std.vsl
ddd.vsl.h: $(srcdir)/../vsllib/fonts.vsl
ddd.vsl.h: $(srcdir)/../vsllib/colors.vsl
ddd.vsl.h: $(srcdir)/../vsllib/builtin.vsl


## The programs.

$(ddd):	$(ddd_canonical)
	$(RM) $@ $(SYMS); $(LN_S) $(ddd_canonical) $@

$(ddd_canonical): ddd.o $(OBJECTS)
	$(LINK.cc) -o $@ ddd.o $(OBJECTS) $(ALL_X_LIBS) $(LIBS)


## The demonstration programs.

userinfo: userinfo.o $(USERINFO_OBJECTS)
	-$(LINK.cc) -o $@ userinfo.o $(USERINFO_OBJECTS) $(NON_X_LIBS) $(LIBS)

rxtest: rxtest.o $(HUFFMAN_OBJECTS)
	-$(LINK.cc) -o $@ rxtest.o $(HUFFMAN_OBJECTS) $(NON_X_LIBS) $(LIBS)

huffencode: huffencode.o $(HUFFMAN_OBJECTS)
	$(LINK.cc) -o $@ huffencode.o $(HUFFMAN_OBJECTS) $(NON_X_LIBS) $(LIBS)

huffdecode: huffdecode.o $(HUFFMAN_OBJECTS)
	$(LINK.cc) -o $@ huffdecode.o $(HUFFMAN_OBJECTS) $(NON_X_LIBS) $(LIBS)

stringify: stringify.o
	$(LINK.cc) -o $@ stringify.o $(LIBS)

mmtest: mmtest.o $(LIB_OBJECTS) 
	$(LINK.cc) -o $@ mmtest.o $(LIB_OBJECTS) $(ALL_X_LIBS) $(LIBS)

test-file: test-file.o
	$(LINK.cc) -o $@ test-file.o $(ALL_X_LIBS)

test-graph: test-graph.o $(LIB_OBJECTS) 
	$(LINK.cc) -o $@ test-graph.o $(LIB_OBJECTS) $(ALL_X_LIBS) $(LIBS)

vsl:	vsl.o DocSpace.o $(LIB_OBJECTS)
	$(LINK.cc) -o $@ vsl.o DocSpace.o $(LIB_OBJECTS) $(ALL_X_LIBS) $(LIBS)

ttytest: ttytest.o $(BASE_OBJECTS) $(AGENT_OBJECTS)
	$(LINK.cc) -o $@ ttytest.o $(BASE_OBJECTS) $(AGENT_OBJECTS) \
	$(ALL_X_LIBS) $(LIBS)

bug:	bug.o
	$(LINK.cc) -o $@ bug.o $(LIBS)

tString: tString.o  $(HUFFMAN_OBJECTS)
	$(LINK.cc) -o $@ tString.o $(HUFFMAN_OBJECTS) $(NON_X_LIBS) $(LIBS)

cxxtest: cxxtest.o
	$(LINK.cc) -o $@ cxxtest.o $(LIBS)

ctest:  ctest.o
	$(LINK.c) -o $@ ctest.o

ptest:  ptest.o
	$(LINK.p) -o $@ ptest.o

m2test: m2test.mod
	$(COMPILE_AND_LINK.m2) -o $@ -e $@ m2test.mod -lmodula2 -ltermcap

# We don't want no optimizing, but debugging info in our test files
bug.o:	$(srcdir)/bug.C
	$(CC) -g -c -o $@ $(srcdir)/bug.C

cxxtest.o: $(srcdir)/cxxtest.C
	$(CXX) -g -c -o $@ $(srcdir)/cxxtest.C

ctest.o: $(srcdir)/ctest.c
	$(CC) -g -c -o $@ $(srcdir)/ctest.c

huffdecode.o: $(srcdir)/huffdecode.C ddd.man.huff.C
	$(COMPILE.cc) -DMAIN -DHUFFTEXT='"$(srcdir)/ddd.man.huff.C"' \
	$(INCLUDE) -o $@ $(srcdir)/huffdecode.C


## For demonstration and debugging purposes
.PHONY: check
check: Ddd ddd cxxtest
	XUSERFILESEARCHPATH=. XAPPLRESDIR=. ./ddd cxxtest

.PHONY: debug
debug: Ddd $(ddd) cxxtest ddd.gdb syms
	$(GDB) -x $(srcdir)/ddd.gdb ./$(ddd)

$(ddd).syms: $(ddd)
	@echo 'Creating $@...'
	@test "`ls -t $(ddd_canonical) $@ 2> /dev/null | head -1`" \
	= $(ddd_canonical) && (set -x; \
	nice $(GDB) -batch -nx -mapped -readnow $(ddd_canonical) \
	&& $(MV) $(ddd_canonical).syms $@ || $(RM) $@); true
	@echo 'Creating $@...done'

# By default, create symbol files in the background
.PHONY: syms
syms:
	$(MAKE) $(ddd).syms > $(ddd).syms.log 2>&1 &


# A convient target for setting up a debugging environment.
.PHONY: it
it:	all cxxtest ctest syms
	@:



## Lex and Yacc stuff.

# VSL parsers
vsl-lex.C: vsl-lex.L
vsl-gramma.h: vsl-lex.L
vsl-gramma.C: vsl-gramma.Y

# Regexp parsers
rxscan.C: rxscan.L

# `make depend' fails to find these dependencies :-(
VSLRead.o: vsl-lex.C vsl-gramma.h vsl-gramma.C
regexps.o: rxscan.C


## The manual page in PostScript format, including all pictures.

$(srcdir)/../doc/ddd.man.ps: ddd.man $(PICS)
	$(GROFF) -man ddd.man > $@

$(srcdir)/../doc/ddd.man-nopics.ps: ddd.man-nopics
	$(GROFF) -man ddd.man-nopics > $@

$(picdir)/ddd-all.ps: \
	$(picdir)/ddd-all.fig $(picdir)/ddd-all.xpm
	cd $(picdir); $(FIG2PS) ddd-all.fig > ddd-all.ps

$(picdir)/ddd-console.ps: \
	$(picdir)/ddd-console.fig $(picdir)/ddd-console.xpm
	cd $(picdir); $(FIG2PS) ddd-console.fig > ddd-console.ps

$(picdir)/ddd-history.ps: \
	$(picdir)/ddd-history.fig $(picdir)/ddd-history.xpm
	cd $(picdir); $(FIG2PS) ddd-history.fig > ddd-history.ps

$(picdir)/ddd-open.ps: \
	$(picdir)/ddd-open.fig $(picdir)/ddd-open.xpm
	cd $(picdir); $(FIG2PS) ddd-open.fig > ddd-open.ps

$(picdir)/ddd-source.ps: \
	$(picdir)/ddd-source.fig $(picdir)/ddd-source.xpm
	cd $(picdir); $(FIG2PS) ddd-source.fig > ddd-source.ps

$(picdir)/ddd-cond.ps: \
	$(picdir)/ddd-cond.fig $(picdir)/ddd-cond.xpm
	cd $(picdir); $(FIG2PS) ddd-cond.fig > ddd-cond.ps

$(picdir)/ddd-line-popup.ps: \
	$(picdir)/ddd-line-popup.fig $(picdir)/ddd-line-popup.xpm
	cd $(picdir); $(FIG2PS) ddd-line-popup.fig > ddd-line-popup.ps

$(picdir)/ddd-bp-popup.ps: \
	$(picdir)/ddd-bp-popup.fig $(picdir)/ddd-bp-popup.xpm
	cd $(picdir); $(FIG2PS) ddd-bp-popup.fig > ddd-bp-popup.ps

$(picdir)/ddd-source-popup.ps: \
	$(picdir)/ddd-source-popup.fig $(picdir)/ddd-source-popup.xpm
	cd $(picdir); $(FIG2PS) ddd-source-popup.fig > ddd-source-popup.ps

$(picdir)/ddd-arguments.ps: \
	$(picdir)/ddd-arguments.fig $(picdir)/ddd-arguments.xpm
	cd $(picdir); $(FIG2PS) ddd-arguments.fig > ddd-arguments.ps

$(picdir)/ddd-tool.ps: $(picdir)/ddd-tool.fig $(picdir)/ddd-tool.xpm
	cd $(picdir); $(FIG2PS) ddd-tool.fig > ddd-tool.ps

$(picdir)/ddd-backtrace.ps: \
	$(picdir)/ddd-backtrace.fig $(picdir)/ddd-backtrace.xpm
	cd $(picdir); $(FIG2PS) ddd-backtrace.fig > ddd-backtrace.ps

$(picdir)/ddd-value-tip.ps: \
	$(picdir)/ddd-value-tip.fig $(picdir)/ddd-value-tip.xpm
	cd $(picdir); $(FIG2PS) ddd-value-tip.fig > ddd-value-tip.ps

$(picdir)/ddd-print-popup.ps: \
	$(picdir)/ddd-print-popup.fig $(picdir)/ddd-print-popup.xpm
	cd $(picdir); $(FIG2PS) ddd-print-popup.fig > ddd-print-popup.ps

$(picdir)/ddd-new-display.ps: \
	$(picdir)/ddd-new-display.fig $(picdir)/ddd-new-display.xpm
	cd $(picdir); $(FIG2PS) ddd-new-display.fig > ddd-new-display.ps

$(picdir)/ddd-select-display.ps: \
	$(picdir)/ddd-select-display.fig $(picdir)/ddd-select-display.xpm
	cd $(picdir); $(FIG2PS) ddd-select-display.fig > ddd-select-display.ps

$(picdir)/ddd-hide-display.ps: \
	$(picdir)/ddd-hide-display.fig $(picdir)/ddd-hide-display.xpm
	cd $(picdir); $(FIG2PS) ddd-hide-display.fig > ddd-hide-display.ps

$(picdir)/ddd-rotate-display.ps: \
	$(picdir)/ddd-rotate-display.fig $(picdir)/ddd-rotate-display.xpm
	cd $(picdir); $(FIG2PS) ddd-rotate-display.fig > ddd-rotate-display.ps

$(picdir)/ddd-locals.ps: \
	$(picdir)/ddd-locals.fig $(picdir)/ddd-locals.xpm
	cd $(picdir); $(FIG2PS) ddd-locals.fig > ddd-locals.ps

$(picdir)/ddd-status-displays.ps: \
	$(picdir)/ddd-status-displays.fig $(picdir)/ddd-status-displays.xpm
	cd $(picdir); $(FIG2PS) ddd-status-displays.fig > ddd-status-displays.ps

$(picdir)/ddd-set.ps: \
	$(picdir)/ddd-set.fig $(picdir)/ddd-set.xpm
	cd $(picdir); $(FIG2PS) ddd-set.fig > ddd-set.ps

$(picdir)/ddd-layout.ps: \
	$(picdir)/ddd-layout.fig $(picdir)/ddd-layout.xpm
	cd $(picdir); $(FIG2PS) ddd-layout.fig > ddd-layout.ps

$(picdir)/ddd-print-graph.ps: \
	$(picdir)/ddd-print-graph.fig $(picdir)/ddd-print-graph.xpm
	cd $(picdir); $(FIG2PS) ddd-print-graph.fig > ddd-print-graph.ps

$(picdir)/ddd-print-output.ps: \
	$(picdir)/ddd-print-output.fig $(picdir)/ddd-graph.eps
	cd $(picdir); $(FIG2PS) ddd-print-output.fig > ddd-print-output.ps

$(picdir)/ddd-code.ps: \
	$(picdir)/ddd-code.fig $(picdir)/ddd-code.xpm
	cd $(picdir); $(FIG2PS) ddd-code.fig > ddd-code.ps

$(picdir)/ddd-registers.ps: \
	$(picdir)/ddd-registers.fig $(picdir)/ddd-registers.xpm
	cd $(picdir); $(FIG2PS) ddd-registers.fig > ddd-registers.ps

$(picdir)/ddd-general-prefs.ps: \
	$(picdir)/ddd-general-prefs.fig $(picdir)/ddd-general-prefs.xpm 
	cd $(picdir); $(FIG2PS) ddd-general-prefs.fig > ddd-general-prefs.ps

$(picdir)/ddd-source-prefs.ps: \
	$(picdir)/ddd-source-prefs.fig $(picdir)/ddd-source-prefs.xpm
	cd $(picdir); $(FIG2PS) ddd-source-prefs.fig > ddd-source-prefs.ps

$(picdir)/ddd-data-prefs.ps: \
	$(picdir)/ddd-data-prefs.fig $(picdir)/ddd-data-prefs.xpm
	cd $(picdir); $(FIG2PS) ddd-data-prefs.fig > ddd-data-prefs.ps

$(picdir)/ddd-startup-prefs.ps: \
	$(picdir)/ddd-startup-prefs.fig $(picdir)/ddd-startup-prefs.xpm
	cd $(picdir); $(FIG2PS) ddd-startup-prefs.fig > ddd-startup-prefs.ps

$(picdir)/ddd-settings.ps: \
	$(picdir)/ddd-settings.fig $(picdir)/ddd-settings.xpm
	cd $(picdir); $(FIG2PS) ddd-settings.fig > ddd-settings.ps

$(picdir)/ddd-threads.ps: \
	$(picdir)/ddd-threads.fig $(picdir)/ddd-threads.xpm
	cd $(picdir); $(FIG2PS) ddd-threads.fig > ddd-threads.ps

$(picdir)/ddd-aliases.ps: \
	$(picdir)/ddd-aliases.fig $(picdir)/ddd-aliases.xpm
	cd $(picdir); $(FIG2PS) ddd-aliases.fig > ddd-aliases.ps

$(picdir)/ddd-edit-displays.ps: \
	$(picdir)/ddd-edit-displays.fig $(picdir)/ddd-edit-displays.xpm
	cd $(picdir); $(FIG2PS) ddd-edit-displays.fig > ddd-edit-displays.ps

$(picdir)/ddd-attach.ps: \
	$(picdir)/ddd-attach.fig $(picdir)/ddd-attach.xpm
	cd $(picdir); $(FIG2PS) ddd-attach.fig > ddd-attach.ps

$(picdir)/ddd-save-session.ps: \
	$(picdir)/ddd-save-session.fig $(picdir)/ddd-save-session.xpm
	cd $(picdir); $(FIG2PS) ddd-save-session.fig > ddd-save-session.ps

$(picdir)/ddd-open-session.ps: \
	$(picdir)/ddd-open-session.fig $(picdir)/ddd-open-session.xpm
	cd $(picdir); $(FIG2PS) ddd-open-session.fig > ddd-open-session.ps

$(picdir)/ddd-button-editor.ps: \
	$(picdir)/ddd-button-editor.fig $(picdir)/ddd-button-editor.xpm
	cd $(picdir); $(FIG2PS) ddd-button-editor.fig > ddd-button-editor.ps

$(picdir)/ddd-shortcuts.ps: \
	$(picdir)/ddd-shortcuts.fig $(picdir)/ddd-shortcuts.xpm
	cd $(picdir); $(FIG2PS) ddd-shortcuts.fig > ddd-shortcuts.ps

$(picdir)/ddd-shortcut-editor.ps: \
	$(picdir)/ddd-shortcut-editor.fig $(picdir)/ddd-shortcut-editor.xpm
	cd $(picdir); $(FIG2PS) ddd-shortcut-editor.fig > ddd-shortcut-editor.ps

$(picdir)/ddd-drag.ps: \
	$(picdir)/ddd-drag.fig \
	$(picdir)/ddd-drag1.xpm $(picdir)/ddd-drag2.xpm $(picdir)/ddd-drag3.xpm
	cd $(picdir); $(FIG2PS) ddd-drag.fig > ddd-drag.ps

# The logo comes in XPM source
$(picdir)/dddlogo.ps: $(icondir)/dddlogo.xpm
	$(XPMTOPPM) $(icondir)/dddlogo.xpm | $(PNMDEPTH) 255 | \
	$(PNMTOPS) -noturn > $@


## Icons and logos.

# All X bitmaps are derived from the XPM sources.

$(icondir)/ddd.xbm: $(icondir)/ddd.xpm
	-$(SXPM) -nod -o - -mono $(srcdir)/../icons/ddd.xpm | \
	$(SED) 's/[nN]one/white/g' | $(SED) 's/gr[ae]y/white/g' | \
	$(XPMTOPPM) | $(PNMDEPTH) 255 | $(PPMTOPGM) | $(PGMTOPBM) | \
	$(PBMTOXBM) | $(SED) 's/noname/ddd/g' > tmp.xbm
	test -s tmp.xbm && $(MV) tmp.xbm $@ || ($(RM) tmp.xbm; false)

$(icondir)/dddmask.xbm: $(icondir)/ddd.xpm
	-$(SXPM) -nod -o - -mono $(srcdir)/../icons/ddd.xpm | \
	$(SED) 's/[nN]one/white/g' | $(SED) 's/gr[ae]y/black/g' | \
	$(XPMTOPPM) | $(PNMDEPTH) 255 | $(PPMTOPGM) | $(PGMTOPBM) | \
	$(PBMTOXBM) | $(SED) 's/noname/dddmask/g' > tmp.xbm
	test -s tmp.xbm && $(MV) tmp.xbm $@ || ($(RM) tmp.xbm; false)

$(icondir)/dddlogo.xbm: $(icondir)/dddlogo.xpm
	$(SXPM) -nod -o - -grey $(icondir)/dddlogo.xpm | $(XPMTOPPM) | \
	$(PNMDEPTH) 255 | $(PNMGAMMA) 0.45 | $(PPMTOPGM) | $(PGMENHANCE) -7 | \
	$(PGMTOPBM) | $(PBMTOXBM) | $(SED) 's/noname/dddlogo/g' > tmp.xbm
	test -s tmp.xbm && $(MV) tmp.xbm $@ || ($(RM) tmp.xbm; false)


## Configuration stuff.

Makefile: $(srcdir)/Makefile.in config.status
	CONFIG_FILES=$@ CONFIG_HEADERS= $(SHELL) ./config.status

Ddd: $(srcdir)/Ddd.in config.status
	CONFIG_FILES=$@ CONFIG_HEADERS= $(SHELL) ./config.status

$(srcdir)/configure: $(srcdir)/configure.in $(srcdir)/aclocal.m4
	-cd $(srcdir) && $(AUTOCONF)
config.status: $(srcdir)/configure
	-$(SHELL) ./config.status --recheck || $(SHELL) $(srcdir)/configure -v

.PRECIOUS: Makefile configure config.status config.h Ddd

# autoheader might not change config.h.in
$(srcdir)/config.h.in: stamp-h.in
$(srcdir)/stamp-h.in: \
	$(srcdir)/configure.in \
	$(srcdir)/aclocal.m4 \
	$(srcdir)/acconfig.h
	cd $(srcdir) && $(AUTOHEADER)
	$(DATE) > $@

$(srcdir)/acconfig.h: $(srcdir)/acconfig.h.in $(srcdir)/acspecial.h
	( \
		echo "define(srcdir, \`$(srcdir)')dnl"; \
		echo "include(srcdir()/acconfig.h.in)dnl" \
	) | $(M4) > $@

$(srcdir)/acspecial.h: $(srcdir)/configure.in
	$(GREP) '^ICE_[a-zA-Z0-9_]* *(' $(srcdir)/configure.in > $@


# config.status might not change config.h
config.h: stamp-h
stamp-h: config.h.in config.status
	CONFIG_FILES= CONFIG_HEADERS=config.h ./config.status
	$(DATE) > $@


# We use configure to create `version.h'.
# To make sure these are not touched upon every invocation,
# we create temporary vr.* files instead and touch the version.* files
# only if the vr.* files changed.
version.h: vr.h
	@$(CMP) vr.h version.h || $(CAT) vr.h > version.h
vr.h: vr.h.in config.status
	CONFIG_FILES=$@ CONFIG_HEADERS= $(SHELL) ./config.status

## The manual page
ddd.man: $(srcdir)/ddd.man.in config.status
	CONFIG_FILES=$@ CONFIG_HEADERS= $(SHELL) ./config.status

# Same, but in 7-bit format
ddd.1:   ddd.man $(srcdir)/unumlaut.sed
	-$(SED) -f $(srcdir)/unumlaut.sed ddd.man > $@

# ddd.man.txt does NOT depend on ddd.man since we don't want it to get
# re-created after each configuration.
ddd.man.txt: $(srcdir)/ddd.man.in configure.in $(srcdir)/umlaut8.sed
	$(MAKE) ddd.man
	-$(SED) -f $(srcdir)/umlaut7.sed ddd.man | \
	$(NROFF) -man | $(SED) -f $(srcdir)/umlaut8.sed > $@

ddd.man.txt.gz: ddd.man.txt
	$(COMPRESS) ddd.man.txt > $@

ddd.man.txt.gz.C: ddd.man.txt.gz
	$(MAKE) stringify
	-./stringify < ddd.man.txt.gz > $@ || $(RM) $@


# ddd.man.huff.C does NOT depend on huffencode since we don't want it
# to get re-created after each configuration.
ddd.man.huff.C: ddd.man.txt
	$(MAKE) huffencode
	-./huffencode < ddd.man.txt > $@ || $(RM) $@

# The `no pictures' variant of ddd.man.
ddd.man-nopics: ddd.man
	$(GREP) -v '^\.PSPIC' ddd.man > ddd.man-nopics

# COPYING.huff.C does NOT depend on huffencode since we don't want it
# to get re-created after each configuration.
COPYING.huff.C: $(srcdir)/../COPYING
	$(MAKE) huffencode
	-$(SED) 's///' < $(srcdir)/../COPYING | ./huffencode > $@ || $(RM) $@

COPYING.gz: $(srcdir)/../COPYING
	$(COMPRESS) $(srcdir)/../COPYING > $@

COPYING.gz.C: COPYING.gz
	$(MAKE) stringify
	-./stringify < COPYING.gz > $@ || $(RM) $@

# `make depend' fails to find this dependency :-(
show.o: COPYING.gz.C ddd.man.txt.gz.C


## The xlibdir script
xlibdir.C: xlibdir.txt

# `make depend' fails to find this dependency :-(
xconfig.o: xlibdir.C


## The host type
host.h: $(srcdir)/host.h.in config.status
	$(CAT) $(srcdir)/host.h.in | \
	$(SED) "s%@HOST_CANONICAL@%$(host_canonical)%" | \
	$(SED) "s%@TARGET_CANONICAL@%$(target_canonical)%" > $@

## Statistics.
# Count lines of C++/lex/yacc source code.
# Lines containing only comments or documentation and empty lines are ignored.

.PHONY: loc stats
loc stats:
	cd $(srcdir); \
	for list in '$(LIB_OBJECTS)' '$(DDD_OBJECTS)' '$(OBJECTS)'; do \
	pattern=`$(ECHO) $$list | $(SED) 's/\([a-zA-Z0-9_]*\)\.o/\1\\.*/g'`; \
	$(ECHO) "Lines of code for $$pattern"; \
	$(CAT) `$(LS) $$pattern | grep '\.[ChLY]'` | \
		$(GREP) -v '^[ 	]*//' | \
		$(GREP) -v '^"' | \
		$(GREP) -v '^[ 	]*$$' | wc -l; \
	done


## EPS code stuff.

$(srcdir)/header.str: $(srcdir)/header.ps
	$(SED) 's/^.*$$/"&\\n"/' $(srcdir)/header.ps > $@

$(srcdir)/trailer.str: $(srcdir)/trailer.ps
	$(SED) 's/^.*$$/"&\\n"/' $(srcdir)/trailer.ps > $@

$(srcdir)/eps-code.h: \
	$(srcdir)/header.str $(srcdir)/trailer.str $(srcdir)/eps-code.x
	$(SED) -e '/prolog/r $(srcdir)/header.str' \
	       -e '/trailer/r $(srcdir)/trailer.str' $(srcdir)/eps-code.x > $@


## Configuration info stuff
configinfo.C: USERINFO $(srcdir)/config-info
	$(SHELL) $(srcdir)/config-info $(srcdir)/USERINFO USERINFO > $@
	-$(CAT) $(srcdir)/USERINFO 2> /dev/null || $(CAT) USERINFO

# configinfo.C:	Makefile config.h

configinfo.o:	configinfo.C configinfo.h

# If `~/.ddd_userinfo' exists, use this file as personal identification

USERINFO: userinfo
	-(cat $$HOME/.ddd_userinfo || ./userinfo || echo '(unknown)') > $@


## Update the shared source tree.  For development only.

PUB_DEST=/ftp/ips/pub/misc/$(ddd)-$(VERSION)/ddd
PUB_SRC=`ls -t /usr/local/share/CVS/ddd/ddd | $(SED) 's/,v//'`
GTEST=/usr/local/gnubin/test

.PHONY: pub
pub:	$(PROG_STUFF) configure $(PUB_DEST)/USERINFO
	@for file in $(PUB_SRC) $(PROG_STUFF) configure Makedeps; do \
	    if $(GTEST) ./$$file -nt $(PUB_DEST)/$$file; then \
		echo -n Updating $(PUB_DEST)/$$file...; \
		cp -p ./$$file $(PUB_DEST)/$$file; \
		echo done.; \
	    fi; \
	done

$(PUB_DEST)/USERINFO:
	-echo 'DDD Development Team <ddd@ips.cs.tu-bs.de>' > $@


## Make dependency stuff.

.PHONY: depend
depend: FORCE

.PRECIOUS: $(srcdir)/Makedeps
$(srcdir)/Makedeps depend:
	@$(ECHO) "Creating $(srcdir)/Makedeps..."
	@( $(ECHO) \#' DO NOT EDIT -- generated automagically by make depend';\
	$(ECHO) \#' Source: $$Id$$'; \
	$(ECHO) ; \
	$(CXX) -M $(CPPFLAGS) $(DEFS) $(INCLUDE) $(srcdir)/*.C \
	| $(SED) 's%$(srcdir)/%%g' \
	| $(SED) 's% /[^ ]*%%g' \
	| $(SED) 's% \./% %g' \
	| $(GREP) -v '^ *\\$$' \
	| $(SED) 's% \.\./% \$$(srcdir)/\.\./%g' \
	| $(SED) 's%^ *$$%& config.h%g' ) > Makedeps~
	$(MV) Makedeps~ $(srcdir)/Makedeps
	@$(ECHO) "Creating $(srcdir)/Makedeps...done."

## If your `make' cannot handle the following line,
## just replace it by the contents of `@srcdir@/Makedeps'.
include @srcdir@/Makedeps
